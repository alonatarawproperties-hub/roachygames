<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roachy Hunt Admin Panel</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
    }
    .header {
      background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
      padding: 20px 30px;
      border-bottom: 1px solid #2d4a6f;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { color: #d4a574; font-size: 24px; }
    .header .api-key-form { display: flex; gap: 10px; }
    .header input {
      padding: 8px 12px;
      border: 1px solid #2d4a6f;
      border-radius: 6px;
      background: #1a1a2e;
      color: #e0e0e0;
      width: 250px;
    }
    .header button {
      padding: 8px 16px;
      background: #d4a574;
      color: #1a1a2e;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .header button:hover { background: #c49464; }
    .nav {
      background: #16213e;
      padding: 10px 30px;
      display: flex;
      gap: 20px;
      border-bottom: 1px solid #2d4a6f;
    }
    .nav a {
      color: #8ba3c7;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.2s;
    }
    .nav a:hover, .nav a.active {
      background: #0f3460;
      color: #d4a574;
    }
    .container { padding: 30px; max-width: 1400px; margin: 0 auto; }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: linear-gradient(135deg, #16213e 0%, #1a2744 100%);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #2d4a6f;
    }
    .stat-card .label { color: #8ba3c7; font-size: 14px; margin-bottom: 8px; }
    .stat-card .value { color: #d4a574; font-size: 32px; font-weight: 700; }
    .section {
      background: #16213e;
      border-radius: 12px;
      border: 1px solid #2d4a6f;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .section-header {
      background: #0f3460;
      padding: 15px 20px;
      font-weight: 600;
      color: #d4a574;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .section-body { padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #2d4a6f;
    }
    th { color: #8ba3c7; font-weight: 500; font-size: 13px; text-transform: uppercase; }
    tr:hover { background: rgba(212, 165, 116, 0.05); }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-warning { background: #f0a500; color: #1a1a2e; }
    .badge-danger { background: #e74c3c; color: white; }
    .badge-success { background: #27ae60; color: white; }
    .badge-info { background: #3498db; color: white; }
    .badge-common { background: #7f8c8d; color: white; }
    .badge-rare { background: #3498db; color: white; }
    .badge-epic { background: #9b59b6; color: white; }
    .badge-legendary { background: #f39c12; color: #1a1a2e; }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: 13px;
      transition: all 0.2s;
    }
    .btn-primary { background: #d4a574; color: #1a1a2e; }
    .btn-primary:hover { background: #c49464; }
    .btn-danger { background: #e74c3c; color: white; }
    .btn-danger:hover { background: #c0392b; }
    .btn-warning { background: #f0a500; color: #1a1a2e; }
    .btn-warning:hover { background: #d49500; }
    .btn-sm { padding: 5px 10px; font-size: 12px; }
    .player-link {
      color: #3498db;
      text-decoration: none;
      cursor: pointer;
    }
    .player-link:hover { text-decoration: underline; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: #16213e;
      border-radius: 12px;
      border: 1px solid #2d4a6f;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #2d4a6f;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h3 { color: #d4a574; }
    .modal-close {
      background: none;
      border: none;
      color: #8ba3c7;
      font-size: 24px;
      cursor: pointer;
    }
    .modal-body { padding: 20px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; color: #8ba3c7; font-size: 13px; }
    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #2d4a6f;
      border-radius: 6px;
      background: #1a1a2e;
      color: #e0e0e0;
    }
    .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
    .loading { text-align: center; padding: 40px; color: #8ba3c7; }
    .error { background: #e74c3c22; border: 1px solid #e74c3c; color: #e74c3c; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .success { background: #27ae6022; border: 1px solid #27ae60; color: #27ae60; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .player-detail { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .player-detail.full { grid-template-columns: 1fr; }
    .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .info-item { padding: 10px; background: #1a1a2e; border-radius: 6px; }
    .info-item .label { font-size: 12px; color: #8ba3c7; }
    .info-item .value { font-size: 16px; color: #e0e0e0; font-weight: 500; }
    .flags-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
    #page-dashboard, #page-players, #page-player-detail { display: none; }
    #page-dashboard.active, #page-players.active, #page-player-detail.active { display: block; }
    .back-btn { margin-bottom: 20px; }
    .catch-list { max-height: 300px; overflow-y: auto; }
    .catch-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #2d4a6f;
    }
    .catch-item:last-child { border-bottom: none; }
  </style>
</head>
<body>
  <div class="header">
    <h1>Roachy Hunt Admin</h1>
    <div class="api-key-form">
      <input type="password" id="apiKeyInput" placeholder="Enter Admin API Key">
      <button onclick="setApiKey()">Connect</button>
    </div>
  </div>
  
  <div class="nav">
    <a href="#dashboard" class="active" data-page="dashboard">Dashboard</a>
    <a href="#players" data-page="players">Players</a>
  </div>
  
  <div class="container">
    <div id="error-container"></div>
    <div id="success-container"></div>
    
    <div id="page-dashboard" class="active">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="label">Total Players</div>
          <div class="value" id="stat-total-players">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Active Today</div>
          <div class="value" id="stat-active-today">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Catches Today</div>
          <div class="value" id="stat-catches-today">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Total Eggs</div>
          <div class="value" id="stat-total-eggs">-</div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span>Flagged Players</span>
          <span id="flagged-count" class="badge badge-danger">0</span>
        </div>
        <div class="section-body">
          <table>
            <thead>
              <tr>
                <th>Player</th>
                <th>Flags</th>
                <th>Catches Today</th>
                <th>Streak</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="flagged-players-table"></tbody>
          </table>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">Top Catchers Today</div>
        <div class="section-body">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Player</th>
                <th>Catches</th>
                <th>Streak</th>
                <th>Level</th>
              </tr>
            </thead>
            <tbody id="top-catchers-table"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <div id="page-players">
      <div class="section">
        <div class="section-header">
          <span>All Hunt Players</span>
          <div>
            <select id="sort-by" onchange="loadPlayers()">
              <option value="catchesToday">Sort by Catches Today</option>
              <option value="streak">Sort by Streak</option>
              <option value="level">Sort by Level</option>
              <option value="eggs">Sort by Eggs</option>
            </select>
          </div>
        </div>
        <div class="section-body">
          <table>
            <thead>
              <tr>
                <th>Player ID</th>
                <th>Catches Today</th>
                <th>Streak</th>
                <th>Level</th>
                <th>Eggs</th>
                <th>Last Active</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="players-table"></tbody>
          </table>
          <div id="players-pagination" style="margin-top: 15px; text-align: center;"></div>
        </div>
      </div>
    </div>
    
    <div id="page-player-detail">
      <button class="btn btn-primary back-btn" onclick="showPage('players')">Back to Players</button>
      <div id="player-detail-content"></div>
    </div>
  </div>
  
  <div class="modal" id="edit-eggs-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Player Eggs</h3>
        <button class="modal-close" onclick="closeModal('edit-eggs-modal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Action</label>
          <select id="egg-action">
            <option value="set">Set exact amounts</option>
            <option value="add">Add eggs</option>
            <option value="remove">Remove eggs</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Common</label>
            <input type="number" id="egg-common" value="0" min="0">
          </div>
          <div class="form-group">
            <label>Rare</label>
            <input type="number" id="egg-rare" value="0" min="0">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Epic</label>
            <input type="number" id="egg-epic" value="0" min="0">
          </div>
          <div class="form-group">
            <label>Legendary</label>
            <input type="number" id="egg-legendary" value="0" min="0">
          </div>
        </div>
        <div class="form-group">
          <label>Reason (optional)</label>
          <input type="text" id="egg-reason" placeholder="Admin adjustment">
        </div>
        <button class="btn btn-primary" onclick="submitEditEggs()">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    let apiKey = localStorage.getItem('adminApiKey') || '';
    let currentPlayerId = null;
    let playersOffset = 0;
    
    document.getElementById('apiKeyInput').value = apiKey ? '••••••••' : '';
    
    function setApiKey() {
      const input = document.getElementById('apiKeyInput');
      if (input.value && !input.value.startsWith('•')) {
        apiKey = input.value;
        localStorage.setItem('adminApiKey', apiKey);
        input.value = '••••••••';
        loadDashboard();
        showSuccess('Connected successfully');
      }
    }
    
    async function apiCall(endpoint, method = 'GET', body = null) {
      const options = {
        method,
        headers: {
          'x-admin-api-key': apiKey,
          'Content-Type': 'application/json'
        }
      };
      if (body) options.body = JSON.stringify(body);
      
      const res = await fetch(`/api/admin/hunt${endpoint}`, options);
      if (!res.ok) {
        const err = await res.json().catch(() => ({ error: 'Request failed' }));
        throw new Error(err.error || 'Request failed');
      }
      return res.json();
    }
    
    function showError(msg) {
      document.getElementById('error-container').innerHTML = `<div class="error">${msg}</div>`;
      setTimeout(() => document.getElementById('error-container').innerHTML = '', 5000);
    }
    
    function showSuccess(msg) {
      document.getElementById('success-container').innerHTML = `<div class="success">${msg}</div>`;
      setTimeout(() => document.getElementById('success-container').innerHTML = '', 3000);
    }
    
    function showPage(page) {
      document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
      document.querySelector(`.nav a[data-page="${page}"]`)?.classList.add('active');
      document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${page}`).classList.add('active');
      
      if (page === 'dashboard') loadDashboard();
      if (page === 'players') loadPlayers();
    }
    
    document.querySelectorAll('.nav a').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        showPage(a.dataset.page);
      });
    });
    
    async function loadDashboard() {
      if (!apiKey) return;
      try {
        const data = await apiCall('/dashboard');
        document.getElementById('stat-total-players').textContent = data.stats.totalPlayers.toLocaleString();
        document.getElementById('stat-active-today').textContent = data.stats.activeToday.toLocaleString();
        document.getElementById('stat-catches-today').textContent = data.stats.catchesToday.toLocaleString();
        document.getElementById('stat-total-eggs').textContent = data.stats.totalEggsInInventory.toLocaleString();
        
        document.getElementById('flagged-count').textContent = data.flaggedPlayers.length;
        const flaggedTable = document.getElementById('flagged-players-table');
        if (data.flaggedPlayers.length === 0) {
          flaggedTable.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#8ba3c7;">No suspicious activity detected</td></tr>';
        } else {
          flaggedTable.innerHTML = data.flaggedPlayers.map(p => `
            <tr>
              <td><span class="player-link" onclick="viewPlayer('${p.walletAddress}')">${p.walletAddress.slice(0,8)}...</span></td>
              <td><div class="flags-list">${p.flags.map(f => `<span class="badge badge-danger">${f}</span>`).join('')}</div></td>
              <td>${p.catchesToday}</td>
              <td>${p.currentStreak} days</td>
              <td>
                <button class="btn btn-sm btn-warning" onclick="viewPlayer('${p.walletAddress}')">View</button>
              </td>
            </tr>
          `).join('');
        }
        
        const topTable = document.getElementById('top-catchers-table');
        if (data.topCatchers.length === 0) {
          topTable.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#8ba3c7;">No catches today</td></tr>';
        } else {
          topTable.innerHTML = data.topCatchers.map((p, i) => `
            <tr>
              <td>${i + 1}</td>
              <td><span class="player-link" onclick="viewPlayer('${p.walletAddress}')">${p.walletAddress.slice(0,8)}...</span></td>
              <td>${p.catchesToday}</td>
              <td>${p.currentStreak} days</td>
              <td>Lv ${p.hunterLevel}</td>
            </tr>
          `).join('');
        }
      } catch (err) {
        showError(err.message);
      }
    }
    
    async function loadPlayers() {
      if (!apiKey) return;
      try {
        const sortBy = document.getElementById('sort-by').value;
        const data = await apiCall(`/players?sortBy=${sortBy}&limit=50&offset=${playersOffset}`);
        
        const table = document.getElementById('players-table');
        table.innerHTML = data.players.map(p => {
          const totalEggs = p.eggCommon + p.eggRare + p.eggEpic + p.eggLegendary;
          return `
            <tr>
              <td><span class="player-link" onclick="viewPlayer('${p.walletAddress}')">${p.walletAddress.slice(0,12)}...</span></td>
              <td>${p.catchesToday}/${p.maxCatchesPerDay}</td>
              <td>${p.currentStreak} (best: ${p.longestStreak})</td>
              <td>Lv ${p.hunterLevel}</td>
              <td>
                <span class="badge badge-common">${p.eggCommon}</span>
                <span class="badge badge-rare">${p.eggRare}</span>
                <span class="badge badge-epic">${p.eggEpic}</span>
                <span class="badge badge-legendary">${p.eggLegendary}</span>
              </td>
              <td>${p.lastCatchDate || 'Never'}</td>
              <td><button class="btn btn-sm btn-primary" onclick="viewPlayer('${p.walletAddress}')">View</button></td>
            </tr>
          `;
        }).join('');
        
        const pagination = document.getElementById('players-pagination');
        pagination.innerHTML = `
          <button class="btn btn-sm btn-primary" ${playersOffset === 0 ? 'disabled' : ''} onclick="prevPage()">Previous</button>
          <span style="margin: 0 15px; color: #8ba3c7;">Page ${Math.floor(playersOffset/50) + 1} of ${Math.ceil(data.pagination.total/50)}</span>
          <button class="btn btn-sm btn-primary" ${!data.pagination.hasMore ? 'disabled' : ''} onclick="nextPage()">Next</button>
        `;
      } catch (err) {
        showError(err.message);
      }
    }
    
    function prevPage() { playersOffset = Math.max(0, playersOffset - 50); loadPlayers(); }
    function nextPage() { playersOffset += 50; loadPlayers(); }
    
    async function viewPlayer(userId) {
      currentPlayerId = userId;
      showPage('player-detail');
      const content = document.getElementById('player-detail-content');
      content.innerHTML = '<div class="loading">Loading player details...</div>';
      
      try {
        const data = await apiCall(`/players/${userId}`);
        const economy = data.economy || {};
        
        content.innerHTML = `
          <div class="player-detail">
            <div class="section">
              <div class="section-header">Player Info</div>
              <div class="section-body">
                <div class="info-grid">
                  <div class="info-item">
                    <div class="label">User ID</div>
                    <div class="value">${data.user?.id || userId}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Display Name</div>
                    <div class="value">${data.user?.displayName || 'Unknown'}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Email</div>
                    <div class="value">${data.user?.email || 'N/A'}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Wallet</div>
                    <div class="value" style="font-size:12px;">${data.user?.walletAddress || userId}</div>
                  </div>
                </div>
                ${data.suspiciousFlags.length > 0 ? `
                  <div style="margin-top: 15px;">
                    <div class="label" style="margin-bottom: 8px; color: #e74c3c;">Suspicious Activity Detected</div>
                    <div class="flags-list">${data.suspiciousFlags.map(f => `<span class="badge badge-danger">${f}</span>`).join('')}</div>
                  </div>
                ` : ''}
                <div class="action-buttons">
                  <button class="btn btn-primary" onclick="openEditEggs()">Edit Eggs</button>
                  <button class="btn btn-warning" onclick="clearStreak()">Clear Streak</button>
                  <button class="btn btn-danger" onclick="resetEconomy()">Reset Economy</button>
                  <button class="btn btn-danger" onclick="banPlayer()">Ban Player</button>
                </div>
              </div>
            </div>
            
            <div class="section">
              <div class="section-header">Economy Stats</div>
              <div class="section-body">
                <div class="info-grid">
                  <div class="info-item">
                    <div class="label">Hunter Level</div>
                    <div class="value">Lv ${economy.hunterLevel || 1} (${economy.hunterXp || 0} XP)</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Current Streak</div>
                    <div class="value">${economy.currentStreak || 0} days (best: ${economy.longestStreak || 0})</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Energy</div>
                    <div class="value">${economy.energy || 0}/${economy.maxEnergy || 30}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Catches Today</div>
                    <div class="value">${economy.catchesToday || 0}/${economy.maxCatchesPerDay || 25}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Catches This Week</div>
                    <div class="value">${economy.catchesThisWeek || 0}/${economy.maxCatchesPerWeek || 120}</div>
                  </div>
                  <div class="info-item">
                    <div class="label">Warmth</div>
                    <div class="value">${economy.warmth || 0}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="player-detail full" style="margin-top: 20px;">
            <div class="section">
              <div class="section-header">Eggs Inventory</div>
              <div class="section-body">
                <div style="display: flex; gap: 20px;">
                  <div style="text-align: center;">
                    <div class="badge badge-common" style="font-size: 24px; padding: 15px 25px;">${data.eggs.counts.common}</div>
                    <div style="margin-top: 5px; color: #8ba3c7;">Common</div>
                  </div>
                  <div style="text-align: center;">
                    <div class="badge badge-rare" style="font-size: 24px; padding: 15px 25px;">${data.eggs.counts.rare}</div>
                    <div style="margin-top: 5px; color: #8ba3c7;">Rare</div>
                  </div>
                  <div style="text-align: center;">
                    <div class="badge badge-epic" style="font-size: 24px; padding: 15px 25px;">${data.eggs.counts.epic}</div>
                    <div style="margin-top: 5px; color: #8ba3c7;">Epic</div>
                  </div>
                  <div style="text-align: center;">
                    <div class="badge badge-legendary" style="font-size: 24px; padding: 15px 25px;">${data.eggs.counts.legendary}</div>
                    <div style="margin-top: 5px; color: #8ba3c7;">Legendary</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="section" style="margin-top: 20px;">
              <div class="section-header">Recent Catches (Last 50)</div>
              <div class="section-body catch-list">
                ${data.recentCatches.length === 0 ? '<div style="color:#8ba3c7;">No catches yet</div>' : 
                  data.recentCatches.map(c => `
                    <div class="catch-item">
                      <div>
                        <span class="badge badge-${c.rarity}">${c.rarity}</span>
                        <span style="margin-left: 10px;">${c.creatureType || 'Unknown'}</span>
                      </div>
                      <div style="color: #8ba3c7; font-size: 13px;">${new Date(c.caughtAt).toLocaleString()}</div>
                    </div>
                  `).join('')}
              </div>
            </div>
          </div>
        `;
      } catch (err) {
        content.innerHTML = `<div class="error">${err.message}</div>`;
      }
    }
    
    function openEditEggs() {
      document.getElementById('edit-eggs-modal').classList.add('active');
    }
    
    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }
    
    async function submitEditEggs() {
      try {
        const result = await apiCall(`/players/${currentPlayerId}/eggs`, 'POST', {
          action: document.getElementById('egg-action').value,
          common: parseInt(document.getElementById('egg-common').value) || 0,
          rare: parseInt(document.getElementById('egg-rare').value) || 0,
          epic: parseInt(document.getElementById('egg-epic').value) || 0,
          legendary: parseInt(document.getElementById('egg-legendary').value) || 0,
          reason: document.getElementById('egg-reason').value
        });
        closeModal('edit-eggs-modal');
        showSuccess('Eggs updated successfully');
        viewPlayer(currentPlayerId);
      } catch (err) {
        showError(err.message);
      }
    }
    
    async function clearStreak() {
      if (!confirm('Clear this player\'s streak? This action is logged.')) return;
      try {
        await apiCall(`/players/${currentPlayerId}/clear-streak`, 'POST', { reason: 'Admin action' });
        showSuccess('Streak cleared');
        viewPlayer(currentPlayerId);
      } catch (err) {
        showError(err.message);
      }
    }
    
    async function resetEconomy() {
      if (!confirm('Reset this player\'s economy? This will set all values to default. This action is logged.')) return;
      try {
        await apiCall(`/players/${currentPlayerId}/reset-economy`, 'POST', { confirm: 'reset', reason: 'Admin action' });
        showSuccess('Economy reset to defaults');
        viewPlayer(currentPlayerId);
      } catch (err) {
        showError(err.message);
      }
    }
    
    async function banPlayer() {
      const action = prompt('Enter action: ban, suspend, or unban');
      if (!action || !['ban', 'suspend', 'unban'].includes(action)) return;
      const reason = prompt('Enter reason:');
      try {
        await apiCall(`/players/${currentPlayerId}/ban`, 'POST', { action, reason });
        showSuccess(`Player ${action}ned successfully (logged to audit)`);
      } catch (err) {
        showError(err.message);
      }
    }
    
    if (apiKey) loadDashboard();
  </script>
</body>
</html>
